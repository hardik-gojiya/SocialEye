{% include "Layout.html" %}

{% block body %}
<div class="flex flex-col items-center p-6">
    <!-- Profile Header -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-3xl text-center">
        <h1 class="text-3xl font-bold text-white">@{{ user.username }}</h1>

        <!-- Follow/Unfollow Button -->
        {% if request.user.is_authenticated %}
        <form action="{% url 'follow_unfollow' user.id %}" method="post" class="mt-3">
            {% csrf_token %}
            <button type="submit" id="followbtn"
                class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-white font-semibold transition">
                {% if request.user in user.following.all %}
                Unfollow
                {% else %}
                Follow
                {% endif %}
            </button>
        </form>
        {% endif %}
    </div>

    <!-- Two-column layout: Posts on left, Reels on right -->
    <div class="mt-6 w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Posts Section -->
        <div>
            <h2 class="text-2xl font-semibold text-white mb-4">ðŸ“¸ Posts</h2>
            <div class="space-y-4">
                {% include "posts.html" with posts=posts %}
            </div>
        </div>

        <!-- Reels Section -->
        <div>
            <h2 class="text-2xl font-semibold text-white mb-4">ðŸŽ¥ Reels</h2>
            <div class="space-y-4">
                {% include "reel_page.html" with reels=reels %}
            </div>
        </div>
    </div>
</div>

<script>
    // Handle Follow/Unfollow with AJAX
    document.getElementById("follow-form").addEventListener("submit", function(event) {
        event.preventDefault();
        
        let formData = new FormData(this);
        fetch(this.action, {
            method: "POST",
            body: formData,
            headers: { "X-CSRFToken": formData.get("csrfmiddlewaretoken") },
            credentials: "same-origin"
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("followbtn").innerText = (data.status === "follow") ? "Unfollow" : "Follow";
        });
    });
</script>
{% endblock %}
